<div class="page-container">
    
    <!-- Header Section -->
    <div class="page-header">
        <div class="title-group">
            <h2>Purchase Orders</h2>
            <p class="subtitle">Manage and track your active orders</p>
        </div>
        <button class="btn-refresh" (click)="loadOrders()" [disabled]="isLoading">
            <span class="icon-spin" [innerHTML]="refreshIcon"></span>
            Refresh
        </button>
    </div>

    <!-- Stats Summary + Search -->
    <div class="stats-row">
        <div class="stats-metrics">
            <div class="stat-item">
                <span class="label">Total Orders</span>
                <span class="value">{{ filteredOrders.length }}</span>
            </div>
            <div class="stat-item">
                <span class="label">Total Value</span>
                <span class="value" *ngIf="filteredOrders.length; else emptyTotal">
                    {{ filteredOrders[0].currency }} {{ totalValue | number:'1.2-2' }}
                </span>
                <ng-template #emptyTotal>
                    <span class="value">â€”</span>
                </ng-template>
            </div>
        </div>
        <div class="stats-search">
            <div class="search-wrapper">
                <span class="search-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
                </span>
                <input 
                    type="text" 
                    [(ngModel)]="searchTerm" 
                    (input)="onSearch()" 
                    placeholder="Search PO Number..."
                    class="search-input stat-search-input"
                >
            </div>
        </div>
    </div>

    <!-- Error State -->
    <div class="error-banner" *ngIf="error">{{ error }}</div>

    <!-- Loading State -->
    <div class="loading-container" *ngIf="isLoading">
        <div class="spinner"></div>
        <p>Fetching data from SAP...</p>
    </div>

    <!-- Data Table -->
    <div class="table-card" *ngIf="!isLoading && !error">
        <div class="table-scroll">
            <table class="data-table">
                <thead>
                    <tr>
                        <th style="width: 15%">PO Number</th>
                        <th style="width: 15%">Date</th>
                        <th style="width: 15%">Material</th>
                        <th style="width: 10%">Org</th>
                        <!-- FIX: Added Specific Alignment Classes -->
                        <th style="width: 15%" class="text-right">Qty</th>
                        <th style="width: 15%" class="text-right">Net Price</th>
                        <th style="width: 15%">Delivery</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngFor="let po of filteredOrders">
                        <td class="primary-text"><strong>{{ po.poNumber }}</strong></td>
                        <td>{{ po.poDate | date:'mediumDate' }}</td>
                        <td>
                            <div class="material-info">
                                <span class="mat-num">{{ po.materialNo }}</span>
                            </div>
                        </td>
                        <td><span class="org-tag">{{ po.purchOrg }}</span></td>
                        
                        <!-- FIX: Data Alignment -->
                        <td class="text-right">{{ 100 }} {{ po.unit }}</td> <!-- Note: XML didnt provide QTY, assumed 100 based on your image, or map from 'NET_PRICE' if that was intended -->
                        
                        <td class="text-right font-weight-bold">
                             {{ po.netPrice | number:'1.2-2' }}
                        </td>
                        
                        <td>{{ po.deliveryDate | date:'mediumDate' }}</td>
                        <td>
                            <span class="badge" [ngClass]="getStatusClass(po.status || 'Open')">
                                {{ po.status }}
                            </span>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Mobile Card View (Visible only on small screens) -->
        <div class="mobile-cards">
            <div class="po-card" *ngFor="let po of filteredOrders">
                <div class="card-header">
                    <span class="po-id">#{{ po.poNumber }}</span>
                    <span class="badge" [ngClass]="getStatusClass(po.status || 'Open')">{{ po.status }}</span>
                </div>
                <div class="card-body">
                    <div class="row">
                        <span class="label">Material:</span>
                        <span class="val">{{ po.materialNo }}</span>
                    </div>
                    <div class="row">
                        <span class="label">Date:</span>
                        <span class="val">{{ po.poDate | date:'shortDate' }}</span>
                    </div>
                    <div class="row">
                        <span class="label">Amount:</span>
                        <span class="val price">{{ po.netPrice | currency:po.currency }}</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Empty State -->
        <div class="empty-state" *ngIf="filteredOrders.length === 0">
            <p *ngIf="searchTerm">No results found for "{{ searchTerm }}"</p>
            <p *ngIf="!searchTerm">No purchase orders found.</p>
        </div>
    </div>
</div>